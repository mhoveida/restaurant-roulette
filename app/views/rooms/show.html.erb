<% content_for :body_class, "bg-black" %>

<div class="room-container" 
     data-controller="room-waiting" 
     data-room-id="<%= @room.id %>">
  <!-- Page Header -->
  <div class="room-page-header">
    <h1 class="room-page-title">Room Waiting Area</h1>
  </div>

  <!-- Room Code Section -->
  <div class="preference-section">
    <h2>Share this code with your friends</h2>
    <p class="subtitle">Invite your friends to join using the room code below</p>

    <div class="room-code-display">
      <div class="room-code-label">Room Code</div>
      <div class="room-code-value">
        Room Code: <span class="code-value"><%= @room.code %></span>
      </div>
    </div>

    <button id="copyCodeBtn" class="button button-secondary" style="width: 100%; margin-top: 1rem;">
      üìã Copy Room Code
    </button>

    <div id="copyConfirmation" class="copy-confirmation" style="display:none; margin-top: 1rem; text-align: center; color: #22c55e; font-weight: 600;">
      Room code <%= @room.code %> copied to clipboard!
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const btn = document.getElementById("copyCodeBtn");
        const confirmation = document.getElementById("copyConfirmation");
        const code = "<%= @room.code %>";

        btn.addEventListener("click", () => {
          navigator.clipboard.writeText(code);
          confirmation.style.display = "block";
          setTimeout(() => (confirmation.style.display = "none"), 2500);
        });
      });
    </script>
  </div>

  <!-- Group Preferences Section -->
  <div class="preference-section">
    <h2>Group Preferences</h2>
    <p class="subtitle">Settings for this spin session</p>

    <div class="preference-grid">
      <div class="preference-item">
        <div class="preference-label">Host</div>
        <div class="preference-value"><%= @room.owner_name %></div>
      </div>

      <div class="preference-item">
        <div class="preference-label">Location</div>
        <div class="preference-value"><%= @room.location %></div>
      </div>

      <div class="preference-item">
        <div class="preference-label">Price Range</div>
        <div class="preference-value"><%= @room.price %></div>
      </div>
    </div>

    <div class="preference-item" style="grid-column: 1 / -1;">
      <div class="preference-label">Cuisines</div>
      <div class="cuisine-list">
        <% if @room.categories.is_a?(Array) %>
          <% @room.categories.each do |cuisine| %>
            <span class="cuisine-tag"><%= cuisine %></span>
          <% end %>
        <% else %>
          <span class="cuisine-tag"><%= @room.categories %></span>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Members Section -->
  <div class="preference-section">
    <h2>Members in Room:</h2>
    <p class="subtitle"><%= @room.get_all_members.length %> <%= "person" if @room.get_all_members.length == 1 %><%= "people" if @room.get_all_members.length > 1 %> joined</p>

    <div class="members-list">
      <% @room.get_all_members.each do |member| %>
        <div class="member-item">
          <div class="member-avatar">üë§</div>
          <div class="member-info">
            <div class="member-name"><%= member[:name] %></div>
            <div class="member-type <%= member[:type] == 'host' ? 'host-badge' : 'guest-badge' %>">
              <% if member[:type] == 'host' %>
                <span>üè† Host</span>
              <% else %>
                <span>üë• Guest</span>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <%= button_to "Ready to Spin?", start_spin_room_path(@room), method: :post, class: "button button-primary" %>
</div>
